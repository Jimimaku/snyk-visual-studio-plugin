namespace Snyk.VisualStudio.Extension.UI.Tree
{
    using System.Collections.ObjectModel;
    using Snyk.VisualStudio.Extension.CLI;

    /// <summary>
    /// Vulnerability tree node.
    /// </summary>
    public class VulnerabilityTreeNode : TreeNode
    {
        /// <summary>
        /// Initializes a new instance of the <see cref="VulnerabilityTreeNode"/> class.
        /// </summary>
        public VulnerabilityTreeNode() => this.Items = new ObservableCollection<VulnerabilityTreeNode>();

        /// <summary>
        /// Gets or sets a value indicating whether Vulnerability for this node.
        /// </summary>
        public Vulnerability Vulnerability { get; set; }

        /// <summary>
        /// Gets or sets a value indicating whether CliGroupedVulnerabilities if it's parent node.
        /// </summary>
        public CliGroupedVulnerabilities Vulnerabilities { get; set; }

        /// <summary>
        /// Gets a value indicating whether title.
        /// If it's parent title it display project name with target CLI file.
        /// If it's leaf node it's display vulnerability package name and title.
        /// </summary>
        public override string Title
        {
            get
            {
                if (this.Vulnerabilities != null)
                {
                    this.title = this.Vulnerabilities.ProjectName + "\\" + this.Vulnerabilities.DisplayTargetFile;
                }

                if (this.Vulnerability != null)
                {
                    this.title = this.Vulnerability.GetPackageNameTitle();
                }

                return this.title;
            }
        }

        /// <summary>
        /// Gets a value indicating whether icon for node.
        /// If it's parent node it will get package manager icon.
        /// If it's leaf node it will display vulnerability severity icon.
        /// </summary>
        public virtual string Icon
        {
            get
            {
                if (this.Vulnerability != null)
                {
                    return SnykIconProvider.GetSeverityIcon(this.Vulnerability.Severity);
                }

                return SnykIconProvider.GetPackageManagerIcon(this.Vulnerabilities.PackageManager);
            }
        }

        /// <summary>
        /// Gets or sets a value indicating whether items.
        /// </summary>
        public ObservableCollection<VulnerabilityTreeNode> Items { get; set; }
    }
}
